<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Denver NightSky Helper</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="container">
    <h1>Denver NightSky Helper ðŸŒ™</h1>
    <p>This app will calculate stargazing times and visible celestial objects for a given date in the Denver area.</p>
    <p>Choose a date to see stargazing conditions.</p>
    <p><i>(Weather conditions are beyond the scope of this app. <a href="https://forecast.weather.gov/MapClick.php?lat=39.738453&lon=-104.984853" target="new">Check Denver weather at NOAA.</a></i></p>

    <form id="observationForm">
      <input type="date" id="obsDate" name="obsDate" required>
      <button type="submit">Check the Sky</button>
    </form>

    <p>(It may take a moment to calculate your results after you click the button.)</p>

    <div class="footer">
      <a href="https://github.com/cvcpatton" target="_blank">By Cathy Patton (GitHub link)</a>
    </div>
  </div>

  <script>
    // Wait until DOM is loaded
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("observationForm");

      form.addEventListener("submit", async (e) => {
        e.preventDefault(); // prevent default form submission

        const obsDate = document.getElementById("obsDate").value;
        if (!obsDate) {
          alert("Please select a date.");
          return;
        }

        try {
          // Call Render API
          const response = await fetch(
            `https://nightsky-helper.onrender.com/api/observations?date=${obsDate}`
          );

          if (!response.ok) {
            throw new Error(`API returned status ${response.status}`);
          }

          const data = await response.json();

          // Save result in localStorage to pass to results.html
          localStorage.setItem("latestObservation", JSON.stringify(data));

          // Redirect to results.html
          window.location.href = "results.html";
        } catch (err) {
          console.error(err);
          alert("Failed to fetch observation. Check console for details.");
        }
      });
    });
  </script>
</body>
</html>
